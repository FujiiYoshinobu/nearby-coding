(()=>{"use strict";var e={398:e=>{e.exports=require("vscode")},733:function(e,n,t){var s=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var i=Object.getOwnPropertyDescriptor(n,t);i&&!("get"in i?!n.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,i)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&s(n,e,t);return i(n,e),n};Object.defineProperty(n,"__esModule",{value:!0}),n.deactivate=n.activate=n.NearbyCodingViewProvider=void 0;const a=r(t(398));class o{constructor(e){this._extensionContext=e,this._disposed=!1,this._lastSeenUsers=new Map,this._context=e,this._userId=this._context.globalState.get("nearbyCoding.userId")||this._generateUserId(),this._context.globalState.update("nearbyCoding.userId",this._userId)}_generateUserId(){return"user-"+Math.random().toString(36).substr(2,9)+"-"+Date.now().toString(36)}resolveWebviewView(e,n,t){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionContext.extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),this._context.subscriptions.push(a.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("nearbyCoding")&&(this._updateWebviewWithCurrentConfig(),this._restartLoops())})),this._updateWebviewWithCurrentConfig(),this._startLoops(),e.onDidDispose(()=>{this._stopLoops()})}_getHtmlForWebview(e){return'<!DOCTYPE html>\n<html lang="ja">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Nearby Coding</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            background-color: #141414;\n            font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n            height: 100vh;\n            overflow: hidden;\n            position: relative;\n        }\n        \n        .plaza {\n            width: 100%;\n            height: 100vh;\n            position: relative;\n            background: linear-gradient(180deg, #141414 0%, #1e1e1e 100%);\n        }\n        \n        .self-avatar {\n            position: absolute;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 2em;\n            z-index: 100;\n        }\n        \n        .visitor {\n            position: absolute;\n            right: -100px;\n            top: 20%;\n            animation: slideIn 1s ease-in-out forwards;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            z-index: 50;\n        }\n        \n        .visitor.leaving {\n            animation: slideOut 1s ease-in-out forwards;\n        }\n        \n        .avatar {\n            font-size: 1.5em;\n        }\n        \n        .message-bubble {\n            background-color: white;\n            color: #333;\n            padding: 8px 12px;\n            border-radius: 15px;\n            font-size: 12px;\n            white-space: nowrap;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n            max-width: 150px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n        }\n        \n        @keyframes slideIn {\n            0% { \n                right: -200px; \n                opacity: 0;\n                transform: translateY(20px);\n            }\n            50% { \n                right: 20px; \n                opacity: 1;\n                transform: translateY(0);\n            }\n            100% { \n                right: 30px; \n                opacity: 1;\n            }\n        }\n        \n        @keyframes slideOut {\n            0% { \n                right: 30px; \n                opacity: 1;\n            }\n            100% { \n                right: -200px; \n                opacity: 0;\n                transform: translateY(-20px);\n            }\n        }\n        \n        .lane {\n            position: absolute;\n            width: 100%;\n            height: 60px;\n            background-color: rgba(30, 30, 30, 0.3);\n            border-radius: 8px;\n        }\n        \n        .lane:nth-child(1) { top: 15%; }\n        .lane:nth-child(2) { top: 35%; }\n        .lane:nth-child(3) { top: 55%; }\n    </style>\n</head>\n<body>\n    <div class="plaza">\n        <div class="lane"></div>\n        <div class="lane"></div>\n        <div class="lane"></div>\n        \n        <div class="self-avatar" id="selfAvatar">üßë‚Äçüíª</div>\n    </div>\n\n    <script>\n        function escapeHtml(unsafe) {\n            return unsafe\n                .replace(/&/g, "&amp;")\n                .replace(/</g, "&lt;")\n                .replace(/>/g, "&gt;")\n                .replace(/"/g, "&quot;")\n                .replace(/\'/g, "&#039;");\n        }\n        \n        let activeVisitors = new Set();\n        let lastSeenUsers = new Map();\n        \n        function showVisitor(user) {\n            // Êó¢„Å´Ë°®Á§∫‰∏≠„ÅÆÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó\n            if (activeVisitors.has(user.id)) {\n                return;\n            }\n            \n            const visitor = document.createElement(\'div\');\n            visitor.className = \'visitor\';\n            visitor.id = \'visitor-\' + user.id;\n            \n            // „É©„É≥„ÉÄ„É†„Å™È´ò„Åï„Å´ÈÖçÁΩÆ\n            const topPercent = 10 + Math.random() * 60;\n            visitor.style.top = topPercent + \'%\';\n            \n            visitor.innerHTML = `\n                <div class="message-bubble">\n                    <strong>${escapeHtml(user.name)}:</strong> ${escapeHtml(user.message)}\n                </div>\n                <div class="avatar">${escapeHtml(user.avatar)}</div>\n            `;\n            \n            document.querySelector(\'.plaza\').appendChild(visitor);\n            activeVisitors.add(user.id);\n            \n            // 5-7ÁßíÂæå„Å´ÈÄÄÂ†¥\n            const exitTime = 5000 + Math.random() * 2000;\n            setTimeout(() => {\n                if (document.getElementById(\'visitor-\' + user.id)) {\n                    visitor.classList.add(\'leaving\');\n                    setTimeout(() => {\n                        if (visitor.parentNode) {\n                            visitor.parentNode.removeChild(visitor);\n                        }\n                        activeVisitors.delete(user.id);\n                    }, 1000);\n                }\n            }, exitTime);\n        }\n        \n        // VSCode„Åã„Çâ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂèó‰ø°\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'updateUsers\':\n                    // Ëá™ÂàÜ„ÅÆ„Ç¢„Éê„Çø„Éº„ÇíÊõ¥Êñ∞\n                    if (message.selfAvatar) {\n                        document.getElementById(\'selfAvatar\').textContent = message.selfAvatar;\n                    }\n                    \n                    // Êñ∞Ë¶è„É¶„Éº„Ç∂„Éº„Åæ„Åü„ÅØÂÜçÂèÇÂä†„É¶„Éº„Ç∂„Éº„ÅÆ„Åø„ÇíÊå®Êã∂Ë°®Á§∫\n                    if (message.newUsers && message.newUsers.length > 0) {\n                        message.newUsers.forEach(user => {\n                            if (user.id !== message.selfId && !activeVisitors.has(user.id)) {\n                                showVisitor(user);\n                            }\n                        });\n                    }\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>'}_getConfiguration(){const e=a.workspace.getConfiguration("nearbyCoding");let n=e.get("serverUrl","https://nearby-coding-server-i3mbz1w0s-fujii-yoshinobus-projects.vercel.app");return n.endsWith("/api/nearby")||(n=n.replace(/\/$/,"")+"/api/nearby"),{serverUrl:n,name:e.get("name","Anonymous"),message:e.get("message","„Çà„Çç„Åó„ÅèÔºÅ"),avatar:e.get("avatar","üßë‚Äçüíª")}}async _sendPing(){if(this._disposed)return;const e=this._getConfiguration();try{const n=await fetch(e.serverUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this._userId,name:e.name,message:e.message,avatar:e.avatar})});n.ok||console.warn("Nearby Coding: Ping failed",n.status)}catch(e){console.warn("Nearby Coding: Ping error",e)}}async _fetchUsers(){if(this._disposed||!this._view)return;const e=this._getConfiguration();try{const n=await fetch(e.serverUrl,{method:"GET"});if(n.ok){const t=await n.json(),s=[],i=Date.now();t.forEach(e=>{if(e.id!==this._userId){const n=this._lastSeenUsers.get(e.id)||0;(!n||i-n>3e5)&&s.push(e),this._lastSeenUsers.set(e.id,i)}}),this._view.webview.postMessage({command:"updateUsers",users:t,newUsers:s,selfId:this._userId,selfAvatar:e.avatar})}}catch(e){console.warn("Nearby Coding: Fetch users error",e)}}_startLoops(){this._stopLoops(),this._sendPing(),this._postInterval=setInterval(()=>{this._sendPing()},1e4),this._getInterval=setInterval(()=>{this._fetchUsers()},6e3),setTimeout(()=>{this._fetchUsers()},1e3)}_stopLoops(){this._postInterval&&(clearInterval(this._postInterval),this._postInterval=void 0),this._getInterval&&(clearInterval(this._getInterval),this._getInterval=void 0)}_updateWebviewWithCurrentConfig(){if(!this._view)return;const e=this._getConfiguration();this._view.webview.postMessage({command:"updateUsers",users:[],selfId:this._userId,selfAvatar:e.avatar})}_restartLoops(){this._stopLoops(),this._startLoops()}dispose(){this._disposed=!0,this._stopLoops()}}n.NearbyCodingViewProvider=o,o.viewType="nearbyCoding.plaza",n.activate=function(e){const n=new o(e);e.subscriptions.push(a.window.registerWebviewViewProvider(o.viewType,n,{webviewOptions:{retainContextWhenHidden:!0}}))},n.deactivate=function(){}}},n={},t=function t(s){var i=n[s];if(void 0!==i)return i.exports;var r=n[s]={exports:{}};return e[s].call(r.exports,r,r.exports,t),r.exports}(733);module.exports=t})();
//# sourceMappingURL=extension.js.map