{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://nearby-coding-extension/./src/extension.ts","webpack://nearby-coding-extension/external commonjs \"vscode\"","webpack://nearby-coding-extension/webpack/bootstrap","webpack://nearby-coding-extension/webpack/before-startup","webpack://nearby-coding-extension/webpack/startup","webpack://nearby-coding-extension/webpack/after-startup"],"sourcesContent":["import * as vscode from 'vscode';\r\n\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  message: string;\r\n  avatar: string;\r\n  lastSeen: number;\r\n}\r\n\r\nexport class NearbyCodingViewProvider implements vscode.WebviewViewProvider {\r\n  public static readonly viewType = 'nearbyCoding.plaza';\r\n  \r\n  private _view?: vscode.WebviewView;\r\n  private _context: vscode.ExtensionContext;\r\n  private _userId: string;\r\n  private _postInterval?: any;\r\n  private _getInterval?: any;\r\n  private _disposed = false;\r\n  private _lastSeenUsers = new Map<string, number>(); // ユーザーIDと最後に見た時刻を記録\r\n\r\n  constructor(private readonly _extensionContext: vscode.ExtensionContext) {\r\n    this._context = _extensionContext;\r\n    \r\n    // ユーザーIDを取得または生成\r\n    this._userId = this._context.globalState.get('nearbyCoding.userId') || this._generateUserId();\r\n    this._context.globalState.update('nearbyCoding.userId', this._userId);\r\n  }\r\n\r\n  private _generateUserId(): string {\r\n    return 'user-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now().toString(36);\r\n  }\r\n\r\n  public resolveWebviewView(\r\n    webviewView: vscode.WebviewView,\r\n    context: vscode.WebviewViewResolveContext,\r\n    token: vscode.CancellationToken\r\n  ) {\r\n    this._view = webviewView;\r\n\r\n    webviewView.webview.options = {\r\n      enableScripts: true,\r\n      localResourceRoots: [this._extensionContext.extensionUri]\r\n    };\r\n\r\n    webviewView.webview.html = this._getHtmlForWebview(webviewView.webview);\r\n    \r\n    // 設定変更時の処理\r\n    this._context.subscriptions.push(\r\n      vscode.workspace.onDidChangeConfiguration(e => {\r\n        if (e.affectsConfiguration('nearbyCoding')) {\r\n          // 設定変更時は即座にWebviewを更新してからループを再開\r\n          this._updateWebviewWithCurrentConfig();\r\n          this._restartLoops();\r\n        }\r\n      })\r\n    );\r\n\r\n    // ビューが表示されたら初期設定を反映してから開始\r\n    this._updateWebviewWithCurrentConfig();\r\n    this._startLoops();\r\n\r\n    // Webviewが破棄される時のクリーンアップ\r\n    webviewView.onDidDispose(() => {\r\n      this._stopLoops();\r\n    });\r\n  }\r\n\r\n  private _getHtmlForWebview(webview: vscode.Webview): string {\r\n    return `<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Nearby Coding</title>\r\n    <style>\r\n        body {\r\n            margin: 0;\r\n            padding: 0;\r\n            background-color: #141414;\r\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n            height: 100vh;\r\n            overflow: hidden;\r\n            position: relative;\r\n        }\r\n        \r\n        .plaza {\r\n            width: 100%;\r\n            height: 100vh;\r\n            position: relative;\r\n            background: linear-gradient(180deg, #141414 0%, #1e1e1e 100%);\r\n        }\r\n        \r\n        .self-avatar {\r\n            position: absolute;\r\n            bottom: 20px;\r\n            left: 50%;\r\n            transform: translateX(-50%);\r\n            font-size: 2em;\r\n            z-index: 100;\r\n        }\r\n        \r\n        .visitor {\r\n            position: absolute;\r\n            right: -100px;\r\n            top: 20%;\r\n            animation: slideIn 1s ease-in-out forwards;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 10px;\r\n            z-index: 50;\r\n        }\r\n        \r\n        .visitor.leaving {\r\n            animation: slideOut 1s ease-in-out forwards;\r\n        }\r\n        \r\n        .avatar {\r\n            font-size: 1.5em;\r\n        }\r\n        \r\n        .message-bubble {\r\n            background-color: white;\r\n            color: #333;\r\n            padding: 8px 12px;\r\n            border-radius: 15px;\r\n            font-size: 12px;\r\n            white-space: nowrap;\r\n            box-shadow: 0 2px 8px rgba(0,0,0,0.3);\r\n            max-width: 150px;\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n        }\r\n        \r\n        @keyframes slideIn {\r\n            0% { \r\n                right: -200px; \r\n                opacity: 0;\r\n                transform: translateY(20px);\r\n            }\r\n            50% { \r\n                right: 20px; \r\n                opacity: 1;\r\n                transform: translateY(0);\r\n            }\r\n            100% { \r\n                right: 30px; \r\n                opacity: 1;\r\n            }\r\n        }\r\n        \r\n        @keyframes slideOut {\r\n            0% { \r\n                right: 30px; \r\n                opacity: 1;\r\n            }\r\n            100% { \r\n                right: -200px; \r\n                opacity: 0;\r\n                transform: translateY(-20px);\r\n            }\r\n        }\r\n        \r\n        .lane {\r\n            position: absolute;\r\n            width: 100%;\r\n            height: 60px;\r\n            background-color: rgba(30, 30, 30, 0.3);\r\n            border-radius: 8px;\r\n        }\r\n        \r\n        .lane:nth-child(1) { top: 15%; }\r\n        .lane:nth-child(2) { top: 35%; }\r\n        .lane:nth-child(3) { top: 55%; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"plaza\">\r\n        <div class=\"lane\"></div>\r\n        <div class=\"lane\"></div>\r\n        <div class=\"lane\"></div>\r\n        \r\n        <div class=\"self-avatar\" id=\"selfAvatar\">🧑‍💻</div>\r\n    </div>\r\n\r\n    <script>\r\n        function escapeHtml(unsafe) {\r\n            return unsafe\r\n                .replace(/&/g, \"&amp;\")\r\n                .replace(/</g, \"&lt;\")\r\n                .replace(/>/g, \"&gt;\")\r\n                .replace(/\"/g, \"&quot;\")\r\n                .replace(/'/g, \"&#039;\");\r\n        }\r\n        \r\n        let activeVisitors = new Set();\r\n        let lastSeenUsers = new Map();\r\n        \r\n        function showVisitor(user) {\r\n            // 既に表示中の場合はスキップ\r\n            if (activeVisitors.has(user.id)) {\r\n                return;\r\n            }\r\n            \r\n            const visitor = document.createElement('div');\r\n            visitor.className = 'visitor';\r\n            visitor.id = 'visitor-' + user.id;\r\n            \r\n            // ランダムな高さに配置\r\n            const topPercent = 10 + Math.random() * 60;\r\n            visitor.style.top = topPercent + '%';\r\n            \r\n            visitor.innerHTML = \\`\r\n                <div class=\"message-bubble\">\r\n                    <strong>\\${escapeHtml(user.name)}:</strong> \\${escapeHtml(user.message)}\r\n                </div>\r\n                <div class=\"avatar\">\\${escapeHtml(user.avatar)}</div>\r\n            \\`;\r\n            \r\n            document.querySelector('.plaza').appendChild(visitor);\r\n            activeVisitors.add(user.id);\r\n            \r\n            // 5-7秒後に退場\r\n            const exitTime = 5000 + Math.random() * 2000;\r\n            setTimeout(() => {\r\n                if (document.getElementById('visitor-' + user.id)) {\r\n                    visitor.classList.add('leaving');\r\n                    setTimeout(() => {\r\n                        if (visitor.parentNode) {\r\n                            visitor.parentNode.removeChild(visitor);\r\n                        }\r\n                        activeVisitors.delete(user.id);\r\n                    }, 1000);\r\n                }\r\n            }, exitTime);\r\n        }\r\n        \r\n        // VSCodeからのメッセージを受信\r\n        window.addEventListener('message', event => {\r\n            const message = event.data;\r\n            \r\n            switch (message.command) {\r\n                case 'updateUsers':\r\n                    // 自分のアバターを更新\r\n                    if (message.selfAvatar) {\r\n                        document.getElementById('selfAvatar').textContent = message.selfAvatar;\r\n                    }\r\n                    \r\n                    // 新規ユーザーまたは再参加ユーザーのみを挨拶表示\r\n                    if (message.newUsers && message.newUsers.length > 0) {\r\n                        message.newUsers.forEach(user => {\r\n                            if (user.id !== message.selfId && !activeVisitors.has(user.id)) {\r\n                                showVisitor(user);\r\n                            }\r\n                        });\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n    </script>\r\n</body>\r\n</html>`;\r\n  }\r\n\r\n  private _getConfiguration() {\r\n    const config = vscode.workspace.getConfiguration('nearbyCoding');\r\n    let serverUrl = config.get<string>('serverUrl', 'https://nearby-coding-server-i3mbz1w0s-fujii-yoshinobus-projects.vercel.app');\r\n    \r\n    // serverUrl が /api/nearby で終わっていない場合は追加\r\n    if (!serverUrl.endsWith('/api/nearby')) {\r\n      serverUrl = serverUrl.replace(/\\/$/, '') + '/api/nearby';\r\n    }\r\n    \r\n    return {\r\n      serverUrl: serverUrl,\r\n      name: config.get<string>('name', 'Anonymous'),\r\n      message: config.get<string>('message', 'よろしく！'),\r\n      avatar: config.get<string>('avatar', '🧑‍💻')\r\n    };\r\n  }\r\n\r\n  private async _sendPing() {\r\n    if (this._disposed) return;\r\n    \r\n    const config = this._getConfiguration();\r\n    \r\n    try {\r\n      const response = await fetch(config.serverUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          id: this._userId,\r\n          name: config.name,\r\n          message: config.message,\r\n          avatar: config.avatar\r\n        })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        console.warn('Nearby Coding: Ping failed', response.status);\r\n      }\r\n    } catch (error) {\r\n      console.warn('Nearby Coding: Ping error', error);\r\n    }\r\n  }\r\n\r\n  private async _fetchUsers() {\r\n    if (this._disposed || !this._view) return;\r\n    \r\n    const config = this._getConfiguration();\r\n    \r\n    try {\r\n      const response = await fetch(config.serverUrl, {\r\n        method: 'GET'\r\n      });\r\n\r\n      if (response.ok) {\r\n        const users: User[] = await response.json();\r\n        \r\n        // 新規ユーザーまたは再参加ユーザーを検知\r\n        const newUsers: User[] = [];\r\n        const currentTime = Date.now();\r\n        \r\n        users.forEach(user => {\r\n          if (user.id !== this._userId) {\r\n            const lastSeen = this._lastSeenUsers.get(user.id) || 0;\r\n            // 初回参加、または5分以上経過後の再参加\r\n            if (!lastSeen || (currentTime - lastSeen) > 300000) {\r\n              newUsers.push(user);\r\n            }\r\n            this._lastSeenUsers.set(user.id, currentTime);\r\n          }\r\n        });\r\n        \r\n        // Webviewにユーザー情報を送信\r\n        this._view.webview.postMessage({\r\n          command: 'updateUsers',\r\n          users: users,\r\n          newUsers: newUsers,\r\n          selfId: this._userId,\r\n          selfAvatar: config.avatar\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.warn('Nearby Coding: Fetch users error', error);\r\n    }\r\n  }\r\n\r\n  private _startLoops() {\r\n    this._stopLoops();\r\n    \r\n    // 初回ping\r\n    this._sendPing();\r\n    \r\n    // 10秒ごとにPOST\r\n    this._postInterval = setInterval(() => {\r\n      this._sendPing();\r\n    }, 10000);\r\n    \r\n    // 6秒ごとにGET\r\n    this._getInterval = setInterval(() => {\r\n      this._fetchUsers();\r\n    }, 6000);\r\n    \r\n    // 初回fetch\r\n    setTimeout(() => {\r\n      this._fetchUsers();\r\n    }, 1000);\r\n  }\r\n\r\n  private _stopLoops() {\r\n    if (this._postInterval) {\r\n      clearInterval(this._postInterval);\r\n      this._postInterval = undefined;\r\n    }\r\n    if (this._getInterval) {\r\n      clearInterval(this._getInterval);\r\n      this._getInterval = undefined;\r\n    }\r\n  }\r\n\r\n  private _updateWebviewWithCurrentConfig() {\r\n    if (!this._view) return;\r\n    \r\n    const config = this._getConfiguration();\r\n    \r\n    // 即座に現在の設定でWebviewを更新\r\n    this._view.webview.postMessage({\r\n      command: 'updateUsers',\r\n      users: [],\r\n      selfId: this._userId,\r\n      selfAvatar: config.avatar\r\n    });\r\n  }\r\n\r\n  private _restartLoops() {\r\n    this._stopLoops();\r\n    this._startLoops();\r\n  }\r\n\r\n  public dispose() {\r\n    this._disposed = true;\r\n    this._stopLoops();\r\n  }\r\n}\r\n\r\nexport function activate(context: vscode.ExtensionContext) {\r\n  const provider = new NearbyCodingViewProvider(context);\r\n  \r\n  context.subscriptions.push(\r\n    vscode.window.registerWebviewViewProvider(\r\n      NearbyCodingViewProvider.viewType, \r\n      provider,\r\n      { webviewOptions: { retainContextWhenHidden: true } }\r\n    )\r\n  );\r\n}\r\n\r\nexport function deactivate() {\r\n  // クリーンアップは自動的に行われる\r\n}","module.exports = require(\"vscode\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(0);\n",""],"names":[],"sourceRoot":""}